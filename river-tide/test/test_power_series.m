dzbdx = 5e-5;
o1 = 2*pi/86400;
q0 = logspace(-2,2,30)';
%q0    = 1;
%dzbdx = logspace(-5,-4,10)';
%dzbdx = logspace(-6,-3,30)';
cd = 2e-3;
g = 9.81;
C = sqrt(g/cd);
x=q0;
%x=dzbdx;

h00 = normal_flow_depth(q0,1,C,dzbdx);

r0      = -sqrt(o1*dzbdx./q0);
r0(:,2) = -sqrt((-o1^2./h00 + 2i*cd*o1*q0./h00.^3)/g);
% second order
r0(:,3) = -((2.*dzbdx.*o1.*(h00.^2.*o1-2i.*cd.*q0))./(h00.*(-2.*dzbdx.^2.*g.*h00+o1.*(h00.^2.*o1-2i.*cd.*q0))));
%r0(:,3) =  (o1.*(h00.^2.*o1-2i.*cd.*q0).*(6.*dzbdx.^2.*g.*h00+o1.*(-h00.^2.*o1+2i.*cd.*q0)))./(g.*h00.^2.*(6.*dzbdx.^3.*g.*h00-3.*dzbdx.*o1.*(h00.^2.*o1-2i.*cd.*q0)+dhdx0.*o1.*(h00.^2.*o1-6i.*cd.*q0)));
r0(:,4) = (o1.*(h00.^2.*o1-2i.*cd.*q0).*(6.*dzbdx.^2.*g.*h00+o1.*(-h00.^2.*o1+2i.*cd.*q0))) ...
             ./(g.*h00.^2.*(6.*dzbdx.^3.*g.*h00-3.*dzbdx.*o1.*(h00.^2.*o1-2i.*cd.*q0)))
r0(:,5) = -((2.*o1.*(h00.^2.*o1-2i.*cd.*q0).*(-12.*dzbdx.^3.*g.*h00+2.*dzbdx.*o1.*(h00.^2.*o1-2i.*cd.*q0))) ...
		./(h00.*(24.*dzbdx.^4.*g.^2.*h00.^2-12.*dzbdx.^2.*g.*h00.*o1.*(h00.^2.*o1-2i.*cd.*q0)+o1.^2.*(h00.^2.*o1-2i.*cd.*q0).^2)));
r0(:,6) = (o1.*(h00.^2.*o1-2i.*cd.*q0).*(120.*dzbdx.^4.*g.^2.*h00.^2-20.*dzbdx.^2.*g.*h00.*o1.*(h00.^2.*o1-2i.*cd.*q0)+o1.^2.*(h00.^2.*o1-2i.*cd.*q0).^2)) ...
		./(g.*h00.^2.*(120.*dzbdx.^5.*g.^2.*h00.^2-60.*dzbdx.^3.*g.*h00.*o1.*(h00.^2.*o1-2i.*cd.*q0)+5.*dzbdx.*o1.^2.*(h00.^2.*o1-2i.*cd.*q0).^2));
%0(:,6) = -(((-2.*h00.*o1.^2.*(h00.^2.*o1-2i.*cd.*q0).^2.*x+6.*dzbdx.^2.*g.*h00.*o1.*(2.*h00.^3.*o1-4i.*cd.*h00.*q0).*x+6.*dzbdx.^3.*g.*h00.*(2.*g.*h00.^3+o1.*(-h00.^2.*o1+2i.*cd.*q0).*x.^2)-3.*dzbdx.*o1.*(h00.^2.*o1-2i.*cd.*q0).*(2.*g.*h00.^3+o1.*(-h00.^2.*o1+2i.*cd.*q0).*x.^2)).*z10)./(2.*g.*h00.^3.*o1.^2.*(6.*dzbdx.^3.*g.*h00-3.*dzbdx.*o1.*(h00.^2.*o1-2i.*cd.*q0))));
%r0(:,6) = (o1.^2.*(36.*dzbdx.^5.*g.^2.*h00.^3-24.*dzbdx.^3.*g.*(h00.^4.*o1.^2+2.*cd.^2.*q0.^2)+3.*dzbdx.*(h00.^5.*o1.^4+4.*cd.^2.*h00.*o1.^2.*q0.^2)))./(g.*h00.*(36.*dzbdx.^6.*g.^2.*h00.^2-36.*dzbdx.^4.*g.*h00.^3.*o1.^2+9.*dzbdx.^2.*(h00.^4.*o1.^4+4.*cd.^2.*o1.^2.*q0.^2)));
%r0(:,6)=(2.*dzbdx.*o1.^2.*(2.*dzbdx.^2.*g.*h00.^3-h00.^4.*o1.^2-4.*cd.^2.*q0.^2))./(4.*dzbdx.^4.*g.^2.*h00.^3-4.*dzbdx.^2.*g.*h00.^4.*o1.^2+h00.^5.*o1.^4+4.*cd.^2.*h00.*o1.^2.*q0.^2);
%dhdx = 0;
%r0(:,6) = (-2.*h00.*o1.^2.*(h00.^2.*o1-2i.*cd.*q0).^2+6.*dzbdx.^2.*g.*h00.*o1.*(2.*h00.^3.*o1-4i.*cd.*h00.*q0))./(12.*dzbdx.^3.*g.^2.*h00.^4-6.*dzbdx.*g.*h00.^3.*o1.*(h00.^2.*o1-2i.*cd.*q0)+2.*dhdx.*g.*h00.^3.*o1.*(h00.^2.*o1-6i.*cd.*q0));
r0(:,7) = (-2.*h00.*o1.^2.*(h00.^2.*o1-2i.*cd.*q0).^2+6.*dzbdx.^2.*g.*h00.*o1.*(2.*h00.^3.*o1-4i.*cd.*h00.*q0))./(12.*dzbdx.^3.*g.^2.*h00.^4-6.*dzbdx.*g.*h00.^3.*o1.*(h00.^2.*o1-2i.*cd.*q0));

r0
real(r0)
%abs(r0)

figure(1)
clf;
subplot(2,2,1)
semilogx(x,real(-r0));
%hold on; set(gca,'colororderindex',1);
subplot(2,2,2)
plot(imag(-r0),'-');
%set(gca,'colororderindex',1);
subplot(2,2,3)
plot(abs(-r0),'-');
legend(num2str((0:5)'))

